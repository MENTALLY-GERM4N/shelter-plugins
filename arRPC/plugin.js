(()=>{var c=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var _=(s,i)=>{for(var t in i)c(s,t,{get:i[t],enumerable:!0})},u=(s,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let a of g(i))!m.call(s,a)&&a!==t&&c(s,a,{get:()=>i[a],enumerable:!(e=y(i,a))||e.enumerable});return s};var v=s=>u(c({},"__esModule",{value:!0}),s);var w={};_(w,{Socket:()=>r,onLoad:()=>f});var{flux:{dispatcher:d,stores:{ApplicationStore:n}},http:{get:p}}=shelter,o={},l={},h=async(s,i)=>{if(!l[s]&&p)try{let e=await p(`/oauth2/applications/${s}/assets`);if(e.status!==200)return console.error("Error fetching resources"),null;l[s]=e.body}catch(e){return console.error("Request failed",e),null}let t=l[s].find(e=>e.name===i);return t?t.id:null},r=class extends WebSocket{constructor(t){super(t);this._url=t,this._reconnectDelay=1e3,this.addEventListener("close",()=>{setTimeout(()=>{this._reconnect()},this._reconnectDelay)}),this.addEventListener("error",()=>{setTimeout(()=>{this._reconnect()},this._reconnectDelay)})}_reconnect(){this.close();let t=new r(this._url);Object.setPrototypeOf(this,Object.getPrototypeOf(t)),Object.assign(this,t)}};function f(){let s=new r("ws://localhost:1337");s.onmessage=async({data:i})=>{let t=JSON.parse(i);if(t.activity?.assets?.large_image.startsWith("https://")?t.activity.assets.large_image=`https://images-ext-1.discordapp.net/external/${t.activity.assets.large_image.replace("https://","https/")}?format=webp&width=300&height=300`:(t.activity?.assets?.large_image&&(t.activity.assets.large_image=await h(t.activity.application_id,t.activity.assets.large_image)),t.activity?.assets?.small_image&&(t.activity.assets.small_image=await h(t.activity.application_id,t.activity.assets.small_image))),t.activity){let e=t.activity.application_id;o[e]||(o[e]=await(Array.isArray(n)?n[0].getApplication(e):n.getApplication(e))||"??");let a=o[e];t.activity.name||(t.activity.name=a.name)}d.dispatch({type:"LOCAL_ACTIVITY_UPDATE",...t})}}return v(w);})();
